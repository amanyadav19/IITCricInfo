Matches

SELECT team1_name AS Team1, team2_name AS Team2, venue_name AS stadium_name, city_name, result, season_year
FROM
	(SELECT match_id, season_year, venue_id, win_type, win_margin, team1_name, team2_name, match_winner_name, concat(match_winner_name, ' won by ', ' ', win_margin, ' ', win_type) as result
	FROM
		(SELECT match_id, season_year, venue_id, win_type, win_margin, team1_name, team2_name, team.team_name as match_winner_name
		FROM
			(SELECT match_id, season_year, venue_id, match_winner, win_type, win_margin, team1_name, team.team_name as team2_name
			FROM
				(SELECT match_id, season_year, team1, team2, venue_id, match_winner, win_type, win_margin, team_name as team1_name
				FROM match
				INNER JOIN team
				ON team1=team.team_id) AS t1
			INNER JOIN team
			ON team2=team.team_id) AS t2
		INNER JOIN team
		ON t2.match_winner = team.team_id) AS t3) AS t4
INNER JOIN venue
ON t4.venue_id = venue.venue_id
ORDER BY season_year DESC;



------------------------ INNING 1 BATTING DATA -------------------------------

SELECT player_id, player_name, runs, balls_faced, strike_rate, fours, COALESCE(sixes, 0) AS sixes
FROM
	(SELECT t4.player_id, t4.player_name, t4.runs, t4.balls_faced, strike_rate, COALESCE(fours, 0) AS fours
	FROM
		(SELECT player_id, player_name, runs, balls_faced, strike_rate
		FROM player
		INNER JOIN
			(SELECT batter, runs, balls_faced, ROUND(((100.0*runs)/balls_faced), 2) AS strike_rate
			FROM
				(SELECT striker AS batter, SUM(runs_scored) AS runs, COUNT(*) AS balls_faced
				FROM (SELECT * FROM ball_by_ball WHERE match_id=$1 AND innings_no=1) AS t1
				GROUP BY striker) AS t2) AS t3
		ON player.player_id = t3.batter) AS t4
	LEFT JOIN
		(SELECT striker as batter, count(*) as fours
		FROM ball_by_ball
		WHERE match_id = $1 AND innings_no=1 AND runs_scored = 4
		GROUP BY striker) AS t5
	ON t4.player_id = t5.batter) AS t7
LEFT JOIN
	(SELECT striker as batter, count(*) as sixes
	FROM ball_by_ball
	WHERE match_id = $1 AND innings_no=1 AND runs_scored = 6
	GROUP BY striker) AS t6
ON t7.player_id = t6.batter
ORDER BY runs DESC;



-------------------- INNING TWO BATTING ---------------------------

SELECT player_id, player_name, runs, balls_faced, strike_rate, fours, COALESCE(sixes, 0) AS sixes
FROM
	(SELECT t4.player_id, t4.player_name, t4.runs, t4.balls_faced, strike_rate, COALESCE(fours, 0) AS fours
	FROM
		(SELECT player_id, player_name, runs, balls_faced, strike_rate
		FROM player
		INNER JOIN
			(SELECT batter, runs, balls_faced, ROUND(((100.0*runs)/balls_faced), 2) AS strike_rate
			FROM
				(SELECT striker AS batter, SUM(runs_scored) AS runs, COUNT(*) AS balls_faced
				FROM (SELECT * FROM ball_by_ball WHERE match_id=$1 AND innings_no=2) AS t1
				GROUP BY striker) AS t2) AS t3
		ON player.player_id = t3.batter) AS t4
	LEFT JOIN
		(SELECT striker as batter, count(*) as fours
		FROM ball_by_ball
		WHERE match_id = $1 AND innings_no=2 AND runs_scored = 4
		GROUP BY striker) AS t5
	ON t4.player_id = t5.batter) AS t7
LEFT JOIN
	(SELECT striker as batter, count(*) as sixes
	FROM ball_by_ball
	WHERE match_id = $1 AND innings_no=2 AND runs_scored = 6
	GROUP BY striker) AS t6
ON t7.player_id = t6.batter
ORDER BY runs DESC;




--------------FIRST BATTING FIRST BOWLING ------------------------SELECT first_batting, team_name as first_bowling
FROM team
INNER JOIN
	(SELECT firstbatting, firstbowling, team_name as first_batting
	FROM team
	INNER JOIN
		(SELECT Firstbatting,
			CASE 
				WHEN Firstbatting=team1 THEN team2
				ELSE team1
			END
			AS Firstbowling
		FROM
			(SELECT team1, team2, toss_winner, toss_name,
				CASE
					WHEN ((team1=toss_winner AND toss_name='bat') OR (team2=toss_winner AND toss_name='field')) THEN team1
					ELSE team2
				END
				AS Firstbatting
			FROM match
			WHERE match_id = 501206) AS t1) AS t2
	ON team.team_id = t2.firstbatting) AS t3
ON team.team_id = t3.firstbowling;

